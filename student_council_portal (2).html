<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Council Portal</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .nav-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-badge {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
        }

        .user-badge.management {
            background: linear-gradient(45deg, #e74c3c, #c0392b);
        }

        .nav-tabs {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
        }

        .nav-tab {
            background: transparent;
            border: 2px solid #667eea;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            color: #667eea;
        }

        .nav-tab:hover {
            background: #667eea;
            color: white;
            transform: translateY(-2px);
        }

        .nav-tab.active {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border-color: transparent;
        }

        .btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: all 0.3s ease;
            margin: 5px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn-danger {
            background: #dc3545;
        }

        .btn-success {
            background: #28a745;
        }

        .btn-warning {
            background: #ffc107;
            color: #212529;
        }

        .btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .btn:disabled:hover {
            transform: none;
            box-shadow: none;
        }

        #backBtn {
            font-size: 14px;
            padding: 10px 16px;
            border-radius: 20px;
            margin-right: 15px;
        }

        .content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            min-height: 500px;
        }

        .hidden {
            display: none;
        }

        /* Dashboard Styles */
        .dashboard-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .metric-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            transition: transform 0.3s ease;
        }

        .metric-card:hover {
            transform: translateY(-5px);
        }

        .metric-card.finance {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        }

        .metric-card.students {
            background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
        }

        .metric-card.events {
            background: linear-gradient(135deg, #ffc107 0%, #fd7e14 100%);
            color: #212529;
        }

        .metric-value {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .metric-label {
            font-size: 16px;
            opacity: 0.9;
        }

        .dashboard-charts {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .chart-container {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .chart-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 20px;
            color: #333;
        }

        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .quick-action-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 20px;
            border-radius: 15px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 500;
            transition: transform 0.3s ease;
            text-align: center;
        }

        .quick-action-btn:hover {
            transform: translateY(-3px);
        }

        /* Finance Styles */
        .finance-overview {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .finance-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .finance-card h3 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 18px;
        }

        .budget-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #e9ecef;
        }

        .budget-item:last-child {
            border-bottom: none;
        }

        .budget-progress {
            width: 100%;
            height: 8px;
            background: #e9ecef;
            border-radius: 4px;
            margin-top: 10px;
        }

        .budget-progress-bar {
            height: 100%;
            background: linear-gradient(45deg, #28a745, #20c997);
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .sponsor-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            margin-bottom: 10px;
        }

        /* Event Management Styles */
        .event-filters {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
            flex-wrap: wrap;
            align-items: center;
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .filter-group label {
            font-weight: 500;
            color: #555;
        }

        .filter-group select, .filter-group input {
            padding: 8px 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 14px;
        }

        .event-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .event-stat-card {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .event-table {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .table-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            font-weight: bold;
        }

        .table-row {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr 1fr 2fr;
            gap: 15px;
            padding: 15px 20px;
            border-bottom: 1px solid #e9ecef;
            align-items: center;
        }

        .table-row:hover {
            background: #f8f9fa;
        }

        .event-actions-table {
            display: flex;
            gap: 5px;
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 12px;
            border-radius: 15px;
        }

        /* Event Records Styles */
        .records-container {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .student-record {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr 1fr;
            gap: 15px;
            padding: 15px;
            border-bottom: 1px solid #e9ecef;
            align-items: center;
        }

        .student-record:hover {
            background: #f8f9fa;
        }

        .payment-status {
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 500;
            text-align: center;
        }

        .payment-paid {
            background: #d4edda;
            color: #155724;
        }

        .payment-pending {
            background: #fff3cd;
            color: #856404;
        }

        .payment-free {
            background: #d1ecf1;
            color: #0c5460;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
        }

        .modal-content {
            background: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            position: relative;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-content.large {
            max-width: 900px;
        }

        .close {
            position: absolute;
            right: 20px;
            top: 20px;
            font-size: 28px;
            cursor: pointer;
            color: #aaa;
        }

        .close:hover {
            color: #000;
        }

        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #555;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        /* Rest of existing styles */
        .welcome-section {
            text-align: center;
            padding: 40px 0;
        }

        .welcome-title {
            font-size: 36px;
            font-weight: bold;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 20px;
        }

        .welcome-subtitle {
            font-size: 18px;
            color: #666;
            margin-bottom: 30px;
        }

        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 40px;
        }

        .feature-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            transition: transform 0.3s ease;
        }

        .feature-card:hover {
            transform: translateY(-5px);
        }

        .feature-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }

        .event-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
            overflow: hidden;
        }

        .event-card:hover {
            transform: translateY(-5px);
        }

        .event-poster {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 10px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        .event-poster:hover {
            transform: scale(1.02);
        }

        .event-poster-placeholder {
            width: 100%;
            height: 200px;
            background: linear-gradient(135deg, #e9ecef 0%, #dee2e6 100%);
            border-radius: 10px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #6c757d;
            font-size: 18px;
            border: 2px dashed #ced4da;
        }

        .event-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .event-title {
            font-size: 20px;
            font-weight: bold;
            color: #333;
        }

        .event-date {
            color: #667eea;
            font-weight: 500;
        }

        .event-description {
            color: #666;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .event-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .enrollment-status {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            padding: 10px;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .enrollment-full {
            background: rgba(220, 53, 69, 0.1);
            border-left-color: #dc3545;
        }

        .enrollment-enrolled {
            background: rgba(40, 167, 69, 0.1);
            border-left-color: #28a745;
        }

        .participants-list {
            background: rgba(248, 249, 250, 0.8);
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            border: 1px solid #e9ecef;
        }

        .participant-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #e9ecef;
        }

        .participant-item:last-child {
            border-bottom: none;
        }

        .image-upload-area {
            border: 2px dashed #667eea;
            border-radius: 10px;
            padding: 30px;
            text-align: center;
            background: rgba(102, 126, 234, 0.05);
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 15px;
        }

        .image-upload-area:hover {
            background: rgba(102, 126, 234, 0.1);
            border-color: #5a67d8;
        }

        .image-upload-area.dragover {
            background: rgba(102, 126, 234, 0.15);
            border-color: #4c51bf;
        }

        .upload-icon {
            font-size: 48px;
            color: #667eea;
            margin-bottom: 10px;
        }

        .image-preview {
            max-width: 100%;
            max-height: 200px;
            border-radius: 10px;
            margin-top: 10px;
        }

        .image-preview-container {
            position: relative;
            display: inline-block;
        }

        .remove-image-btn {
            position: absolute;
            top: -10px;
            right: -10px;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            cursor: pointer;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .event-poster-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1001;
            cursor: pointer;
        }

        .event-poster-modal img {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            max-width: 90%;
            max-height: 90%;
            border-radius: 10px;
        }

        .sponsor-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .sponsor-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .feedback-item {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .feedback-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .feedback-author {
            font-weight: bold;
            color: #667eea;
        }

        /* Scanner Styles */
        .scanner-container {
            max-width: 500px;
            margin: 0 auto;
            text-align: center;
        }

        .scanner-status {
            background: rgba(102, 126, 234, 0.1);
            border: 2px solid #667eea;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .scanner-result {
            background: rgba(248, 249, 250, 0.8);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            border: 1px solid #e9ecef;
            min-height: 100px;
        }

        /* Gallery Styles */
        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .gallery-item {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .gallery-item:hover {
            transform: translateY(-5px);
        }

        .gallery-image {
            width: 100%;
            height: 250px;
            object-fit: cover;
            cursor: pointer;
        }

        .gallery-info {
            padding: 15px;
        }

        .gallery-title {
            font-weight: bold;
            margin-bottom: 5px;
            color: #333;
        }

        .gallery-description {
            color: #666;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .gallery-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 12px;
            color: #999;
        }

        .gallery-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        @media (max-width: 768px) {
            .dashboard-charts {
                grid-template-columns: 1fr;
            }
            
            .table-row {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .student-record {
                grid-template-columns: 1fr;
                gap: 10px;
            }
            
            .nav-tabs {
                justify-content: center;
                flex-wrap: wrap;
            }
            
            .nav-tab {
                padding: 10px 16px;
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="nav-bar">
                <div class="logo">üéì Student Council Portal</div>
                <div class="user-info" id="userInfo">
                    <button class="btn" onclick="showLogin()">Login</button>
                </div>
            </div>
            <div class="nav-tabs" id="navTabs">
                <button class="btn btn-secondary" id="backBtn" style="display: none;" onclick="goBack()">‚Üê Back</button>
                <button class="nav-tab active" onclick="showTab('home')">Home</button>
                <button class="nav-tab" onclick="showTab('about')">About</button>
                <button class="nav-tab" onclick="showTab('events')">Events</button>
                <button class="nav-tab" id="enrolledTab" style="display: none;" onclick="showTab('enrolled')">My Enrolled Events</button>
                <button class="nav-tab" id="scanTab" style="display: none;" onclick="showTab('scan')">Scan QR</button>
                <button class="nav-tab" onclick="showTab('gallery')">Gallery</button>
                <button class="nav-tab" onclick="showTab('sponsors')">Sponsors</button>
                <button class="nav-tab" onclick="showTab('feedback')">Feedback</button>
                <!-- Management Tabs -->
                <button class="nav-tab" id="dashboardTab" style="display: none;" onclick="showTab('dashboard')">Dashboard</button>
                <button class="nav-tab" id="financeTab" style="display: none;" onclick="showTab('finance')">Finance</button>
                <button class="nav-tab" id="manageEventsTab" style="display: none;" onclick="showTab('manage-events')">Manage Events</button>
            </div>
        </div>

        <div class="content" id="content">
            <!-- Management Dashboard -->
            <div id="dashboard" class="tab-content hidden">
                <h2>üìä Management Dashboard</h2>
                
                <!-- Key Metrics -->
                <div class="dashboard-metrics">
                    <div class="metric-card students">
                        <div class="metric-value" id="totalStudentsMetric">0</div>
                        <div class="metric-label">Total Students</div>
                    </div>
                    <div class="metric-card events">
                        <div class="metric-value" id="activeEventsMetric">0</div>
                        <div class="metric-label">Active Events</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value" id="totalEnrollmentsMetric">0</div>
                        <div class="metric-label">Total Enrollments</div>
                    </div>
                    <div class="metric-card finance">
                        <div class="metric-value" id="totalRevenueMetric">‚Çπ0</div>
                        <div class="metric-label">Total Budget</div>
                    </div>
                </div>

                <!-- Charts -->
                <div class="dashboard-charts">
                    <div class="chart-container">
                        <div class="chart-title">üìà Enrollment Trends</div>
                        <canvas id="enrollmentChart" width="400" height="200"></canvas>
                    </div>
                    <div class="chart-container">
                        <div class="chart-title">üìä Event Categories</div>
                        <canvas id="categoryChart" width="200" height="200"></canvas>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="quick-actions">
                    <button class="quick-action-btn" onclick="showAddEventModal()">
                        ‚ûï Add New Event
                    </button>
                    <button class="quick-action-btn" onclick="showAddSponsorModal()">
                        ü§ù Add Sponsor
                    </button>
                    <button class="quick-action-btn" onclick="showEventRecordsModal()">
                        üìã Event Records
                    </button>
                    <button class="quick-action-btn" onclick="generateReport()">
                        üìä Generate Report
                    </button>
                    <button class="quick-action-btn" onclick="showAnnouncementModal()">
                        üì¢ Make Announcement
                    </button>
                </div>

                <!-- Recent Activity -->
                <div class="chart-container">
                    <div class="chart-title">üïê Recent Activity</div>
                    <div id="recentActivity">
                        <!-- Recent activities will be populated here -->
                    </div>
                </div>
            </div>

            <!-- Finance Management -->
            <div id="finance" class="tab-content hidden">
                <h2>üí∞ Finance Management</h2>
                
                <div class="finance-overview">
                    <!-- Budget Overview -->
                    <div class="finance-card">
                        <h3>üìä Budget Overview</h3>
                        <div id="budgetOverview">
                            <!-- Budget items will be populated here -->
                        </div>
                    </div>

                    <!-- Sponsor Management -->
                    <div class="finance-card">
                        <h3>ü§ù Sponsor Management</h3>
                        <button class="btn" onclick="showAddSponsorModal()" style="margin-bottom: 15px;">Add Sponsor</button>
                        <div id="sponsorManagement">
                            <!-- Sponsors will be populated here -->
                        </div>
                    </div>

                    <!-- Financial Reports -->
                    <div class="finance-card">
                        <h3>üìà Financial Reports</h3>
                        <canvas id="financeChart" width="300" height="200"></canvas>
                        <button class="btn" onclick="exportFinancialReport()" style="margin-top: 15px;">Export Report</button>
                    </div>
                </div>
            </div>

            <!-- Event Management -->
            <div id="manage-events" class="tab-content hidden">
                <h2>üéØ Event Management</h2>
                
                <!-- Event Filters -->
                <div class="event-filters">
                    <div class="filter-group">
                        <label>Status:</label>
                        <select id="statusFilter" onchange="filterEvents()">
                            <option value="all">All Events</option>
                            <option value="upcoming">Upcoming</option>
                            <option value="ongoing">Ongoing</option>
                            <option value="completed">Completed</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Search:</label>
                        <input type="text" id="searchFilter" placeholder="Search events..." oninput="filterEvents()">
                    </div>
                    <button class="btn" onclick="showAddEventModal()">‚ûï Add Event</button>
                    <button class="btn btn-secondary" onclick="showEventRecordsModal()">üìã Event Records</button>
                </div>

                <!-- Event Statistics -->
                <div class="event-stats">
                    <div class="event-stat-card">
                        <div class="metric-value" id="upcomingEventsCount">0</div>
                        <div class="metric-label">Upcoming Events</div>
                    </div>
                    <div class="event-stat-card">
                        <div class="metric-value" id="totalParticipants">0</div>
                        <div class="metric-label">Total Participants</div>
                    </div>
                    <div class="event-stat-card">
                        <div class="metric-value" id="averageEnrollment">0%</div>
                        <div class="metric-label">Avg. Enrollment Rate</div>
                    </div>
                </div>

                <!-- Events Table -->
                <div class="event-table">
                    <div class="table-header">
                        <div class="table-row">
                            <div>Event Title</div>
                            <div>Date</div>
                            <div>Location</div>
                            <div>Enrolled</div>
                            <div>Status</div>
                            <div>Actions</div>
                        </div>
                    </div>
                    <div id="eventsTableBody">
                        <!-- Event rows will be populated here -->
                    </div>
                </div>
            </div>

            <!-- Home Tab -->
            <div id="home" class="tab-content">
                <div class="welcome-section">
                    <h1 class="welcome-title">Welcome to Student Council</h1>
                    <p class="welcome-subtitle">Your gateway to campus events, activities, and student engagement</p>
                </div>
                <div class="features">
                    <div class="feature-card">
                        <div class="feature-icon">üìÖ</div>
                        <h3>Events</h3>
                        <p>Discover upcoming events and activities organized by the student council</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">üì∏</div>
                        <h3>Gallery</h3>
                        <p>Browse photos from past events and campus activities</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">ü§ù</div>
                        <h3>Sponsors</h3>
                        <p>Meet our amazing sponsors who make our events possible</p>
                    </div>
                    <div class="feature-card">
                        <div class="feature-icon">üí¨</div>
                        <h3>Feedback</h3>
                        <p>Share your thoughts and suggestions with the student council</p>
                    </div>
                </div>
            </div>

            <!-- Enrolled Events Tab -->
            <div id="enrolled" class="tab-content hidden">
                <h2>My Enrolled Events</h2>
                <div id="enrolledEventsList">
                    <!-- Enrolled events will be shown here -->
                </div>
            </div>

            <!-- About Tab -->
            <div id="about" class="tab-content hidden">
                <h2>About Student Council</h2>
                <p style="margin-bottom: 20px; line-height: 1.6; color: #666;">
                    The Student Council serves as the voice of the student body, working tirelessly to enhance campus life and create memorable experiences for all students. Our mission is to foster a vibrant campus community through engaging events, meaningful initiatives, and open communication between students and administration.
                </p>
                <h3 style="margin-bottom: 15px; color: #667eea;">Our Vision</h3>
                <p style="margin-bottom: 20px; line-height: 1.6; color: #666;">
                    To create an inclusive, dynamic, and supportive environment where every student can thrive academically, socially, and personally.
                </p>
                <h3 style="margin-bottom: 15px; color: #667eea;">What We Do</h3>
                <ul style="margin-left: 20px; line-height: 1.8; color: #666;">
                    <li>Organize campus-wide events and activities</li>
                    <li>Represent student interests in academic and administrative matters</li>
                    <li>Facilitate communication between students and faculty</li>
                    <li>Support student clubs and organizations</li>
                    <li>Promote student welfare and well-being</li>
                    <li>Connect students with our generous sponsors and partners</li>
                </ul>
            </div>

            <!-- Events Tab -->
            <div id="events" class="tab-content hidden">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                    <h2>Campus Events</h2>
                    <button class="btn" id="addEventBtn" style="display: none;" onclick="showAddEventModal()">Add Event</button>
                </div>
                <div id="eventsList">
                    <!-- Events will be populated here -->
                </div>
            </div>

            <!-- QR Scanner Tab -->
            <div id="scan" class="tab-content hidden">
                <h2>QR Code Scanner</h2>
                <div class="scanner-container">
                    <div class="scanner-status">
                        <h3>üì± Scan Student QR Codes</h3>
                        <p>Point your camera at a student's QR code to verify their event enrollment</p>
                    </div>
                    
                    <div id="scanner-wrapper">
                        <div id="reader" style="width: 100%; max-width: 500px; margin: 0 auto;"></div>
                    </div>
                    
                    <button class="btn btn-secondary" id="startScannerBtn" onclick="initializeScanner()" style="margin-top: 15px;">
                        üì∑ Start Camera
                    </button>
                    <button class="btn btn-danger" id="stopScannerBtn" onclick="stopScanner()" style="margin-top: 15px; display: none;">
                        üõë Stop Camera
                    </button>
                    
                    <div id="scanResult" class="scanner-result">
                        Click "Start Camera" to begin scanning QR codes
                    </div>
                </div>
            </div>

            <!-- Gallery Tab -->
            <div id="gallery" class="tab-content hidden">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
                    <h2>üì∏ Photo Gallery</h2>
                    <button class="btn" id="addPhotoBtn" style="display: none;" onclick="showAddPhotoModal()">Upload Photo</button>
                </div>
                <div id="galleryList">
                    <!-- Gallery photos will be populated here -->
                </div>
            </div>

            <!-- Sponsors Tab -->
            <div id="sponsors" class="tab-content hidden">
                <h2>Our Sponsors</h2>
                <p style="margin-bottom: 30px; color: #666;">We're grateful to our sponsors who make our events and activities possible.</p>
                <div class="sponsor-grid">
                    <div class="sponsor-card">
                        <h3>Sai Groups</h3>
                        <p>Supporting and building the lives</p>
                    </div>
                    <div class="sponsor-card">
                        <h3>Campa</h3>
                        <p>Have some desi refreshments</p>
                    </div>
                    <div class="sponsor-card">
                        <h3>Sabbero</h3>
                        <p>Experience new york delight</p>
                    </div>
                    <div class="sponsor-card">
                        <h3>Lenovo</h3>
                        <p>Technology for innovation</p>
                    </div>
                </div>
            </div>

            <!-- Feedback Tab -->
            <div id="feedback" class="tab-content hidden">
                <h2>Student Feedback</h2>
                <div style="margin-bottom: 30px;">
                    <div class="form-group">
                        <label for="feedbackText">Share your feedback:</label>
                        <textarea id="feedbackText" rows="4" placeholder="Your thoughts, suggestions, or comments..."></textarea>
                    </div>
                    <button class="btn" onclick="submitFeedback()">Submit Feedback</button>
                </div>
                <div id="feedbackList">
                    <!-- Feedback will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Login Modal -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="hideModal('loginModal')">&times;</span>
            <h2 style="margin-bottom: 20px; text-align: center;">Login</h2>
            <div style="max-width: 400px; margin: 0 auto; text-align: center;">
                <div class="form-group">
                    <label for="username">Username:</label>
                    <input type="text" id="username" placeholder="Enter your username">
                </div>
                <div class="form-group">
                    <label for="password">Password:</label>
                    <input type="password" id="password" placeholder="Enter your password">
                </div>
                <div class="form-group">
                    <label for="userType">Login as:</label>
                    <select id="userType">
                        <option value="student">Student</option>
                        <option value="secretary">Secretary</option>
                        <option value="management">Management</option>
                    </select>
                </div>
                <button class="btn" onclick="login()">Login</button>
            </div>
            <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 10px; font-size: 14px;">
                <strong>Demo Credentials:</strong><br>
                Student: username=student, password=student123<br>
                Secretary: username=secretary, password=secretary123<br>
                Management: username=admin, password=admin123
            </div>
        </div>
    </div>

    <!-- Event Records Modal -->
    <div id="eventRecordsModal" class="modal">
        <div class="modal-content large">
            <span class="close" onclick="hideModal('eventRecordsModal')">&times;</span>
            <h2 style="margin-bottom: 20px; text-align: center;">üìã Event Records & Student Details</h2>
            
            <div class="form-group">
                <label for="recordEventSelect">Select Event:</label>
                <select id="recordEventSelect" onchange="loadEventRecords()">
                    <option value="">Choose an event...</option>
                </select>
            </div>
            
            <div id="eventRecordsContainer" style="display: none;">
                <div class="records-container">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <div>
                            <h3 id="selectedEventTitle">Event Title</h3>
                            <p id="selectedEventDetails" style="color: #666;"></p>
                        </div>
                        <button class="btn btn-secondary" onclick="exportEventRecord()">üìä Export Record</button>
                    </div>
                    
                    <!-- Records Header -->
                    <div class="student-record" style="background: #667eea; color: white; font-weight: bold;">
                        <div>Student Name</div>
                        <div>Enrollment Date</div>
                        <div>Payment Status</div>
                        <div>Amount</div>
                        <div>Actions</div>
                    </div>
                    
                    <div id="studentRecordsList">
                        <!-- Student records will be populated here -->
                    </div>
                </div>
                
                <!-- Summary Section -->
                <div class="records-container">
                    <h3>üìä Summary</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 15px;">
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; text-align: center;">
                            <div style="font-size: 24px; font-weight: bold; color: #667eea;" id="totalEnrolled">0</div>
                            <div style="font-size: 14px; color: #666;">Total Enrolled</div>
                        </div>
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; text-align: center;">
                            <div style="font-size: 24px; font-weight: bold; color: #28a745;" id="totalPaid">‚Çπ0</div>
                            <div style="font-size: 14px; color: #666;">Total Paid</div>
                        </div>
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; text-align: center;">
                            <div style="font-size: 24px; font-weight: bold; color: #ffc107;" id="totalPending">‚Çπ0</div>
                            <div style="font-size: 14px; color: #666;">Pending Amount</div>
                        </div>
                        <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; text-align: center;">
                            <div style="font-size: 24px; font-weight: bold; color: #17a2b8;" id="enrollmentRate">0%</div>
                            <div style="font-size: 14px; color: #666;">Enrollment Rate</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Event Modal -->
    <div id="addEventModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="hideModal('addEventModal')">&times;</span>
            <h2 style="margin-bottom: 20px; text-align: center;">Add New Event</h2>
            <div class="form-group">
                <label for="eventTitle">Event Title:</label>
                <input type="text" id="eventTitle" placeholder="Enter event title">
            </div>
            <div class="form-group">
                <label for="eventDate">Event Date:</label>
                <input type="date" id="eventDate">
            </div>
            <div class="form-group">
                <label for="eventDescription">Event Description:</label>
                <textarea id="eventDescription" rows="4" placeholder="Enter event description"></textarea>
            </div>
            <div class="form-group">
                <label for="eventLocation">Location:</label>
                <input type="text" id="eventLocation" placeholder="Enter event location">
            </div>
            <div class="form-group">
                <label for="eventPoster">Event Poster:</label>
                <div class="image-upload-area" onclick="document.getElementById('eventPosterInput').click()">
                    <div class="upload-icon">üì∏</div>
                    <p>Click to upload or drag and drop</p>
                    <p style="font-size: 12px; color: #666;">JPG, PNG, GIF up to 5MB</p>
                </div>
                <input type="file" id="eventPosterInput" accept="image/*" style="display: none;" onchange="previewImage('eventPosterInput', 'eventPosterPreview')">
                <div id="eventPosterPreview"></div>
            </div>
            <div class="form-group">
                <label for="eventMaxParticipants">Maximum Participants:</label>
                <input type="number" id="eventMaxParticipants" placeholder="Enter maximum participants" min="1">
            </div>
            <div class="form-group">
                <label for="eventFee">Event Fee (‚Çπ):</label>
                <input type="number" id="eventFee" placeholder="Enter event fee (0 for free)" min="0">
            </div>
            <button class="btn" onclick="addEvent()">Add Event</button>
        </div>
    </div>

    <!-- Edit Event Modal -->
    <div id="editEventModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="hideModal('editEventModal')">&times;</span>
            <h2 style="margin-bottom: 20px; text-align: center;">Edit Event</h2>
            <div class="form-group">
                <label for="editEventTitle">Event Title:</label>
                <input type="text" id="editEventTitle" placeholder="Enter event title">
            </div>
            <div class="form-group">
                <label for="editEventDate">Event Date:</label>
                <input type="date" id="editEventDate">
            </div>
            <div class="form-group">
                <label for="editEventDescription">Event Description:</label>
                <textarea id="editEventDescription" rows="4" placeholder="Enter event description"></textarea>
            </div>
            <div class="form-group">
                <label for="editEventLocation">Location:</label>
                <input type="text" id="editEventLocation" placeholder="Enter event location">
            </div>
            <div class="form-group">
                <label for="editEventPoster">Event Poster:</label>
                <div class="image-upload-area" onclick="document.getElementById('editEventPosterInput').click()">
                    <div class="upload-icon">üì∏</div>
                    <p>Click to upload or drag and drop</p>
                    <p style="font-size: 12px; color: #666;">JPG, PNG, GIF up to 5MB</p>
                </div>
                <input type="file" id="editEventPosterInput" accept="image/*" style="display: none;" onchange="previewImage('editEventPosterInput', 'editEventPosterPreview')">
                <div id="editEventPosterPreview"></div>
            </div>
            <div class="form-group">
                <label for="editEventMaxParticipants">Maximum Participants:</label>
                <input type="number" id="editEventMaxParticipants" placeholder="Enter maximum participants" min="1">
            </div>
            <div class="form-group">
                <label for="editEventFee">Event Fee (‚Çπ):</label>
                <input type="number" id="editEventFee" placeholder="Enter event fee (0 for free)" min="0">
            </div>
            <button class="btn" onclick="updateEvent()">Update Event</button>
        </div>
    </div>

    <!-- Add Photo Modal -->
    <div id="addPhotoModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="hideModal('addPhotoModal')">&times;</span>
            <h2 style="margin-bottom: 20px; text-align: center;">Upload Photo</h2>
            <div class="form-group">
                <label for="photoTitle">Photo Title:</label>
                <input type="text" id="photoTitle" placeholder="Enter photo title">
            </div>
            <div class="form-group">
                <label for="photoDescription">Description:</label>
                <textarea id="photoDescription" rows="3" placeholder="Describe the photo or event..."></textarea>
            </div>
            <div class="form-group">
                <label for="photoCategory">Category:</label>
                <select id="photoCategory">
                    <option value="events">Events</option>
                    <option value="campus">Campus Life</option>
                    <option value="activities">Activities</option>
                    <option value="meetings">Meetings</option>
                    <option value="celebrations">Celebrations</option>
                </select>
            </div>
            <div class="form-group">
                <label for="photoUpload">Photo:</label>
                <div class="image-upload-area" onclick="document.getElementById('photoUploadInput').click()">
                    <div class="upload-icon">üì∏</div>
                    <p>Click to upload or drag and drop</p>
                    <p style="font-size: 12px; color: #666;">JPG, PNG, GIF up to 5MB</p>
                </div>
                <input type="file" id="photoUploadInput" accept="image/*" style="display: none;" onchange="previewImage('photoUploadInput', 'photoUploadPreview')">
                <div id="photoUploadPreview"></div>
            </div>
            <button class="btn" onclick="addPhoto()">Upload Photo</button>
        </div>
    </div>

    <!-- Add Sponsor Modal -->
    <div id="addSponsorModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="hideModal('addSponsorModal')">&times;</span>
            <h2 style="margin-bottom: 20px; text-align: center;">Add New Sponsor</h2>
            <div class="form-group">
                <label for="sponsorName">Sponsor Name:</label>
                <input type="text" id="sponsorName" placeholder="Enter sponsor name">
            </div>
            <div class="form-group">
                <label for="sponsorAmount">Contribution Amount (‚Çπ):</label>
                <input type="number" id="sponsorAmount" placeholder="Enter contribution amount">
            </div>
            <div class="form-group">
                <label for="sponsorContact">Contact Person:</label>
                <input type="text" id="sponsorContact" placeholder="Contact person name">
            </div>
            <div class="form-group">
                <label for="sponsorEmail">Email:</label>
                <input type="email" id="sponsorEmail" placeholder="Contact email">
            </div>
            <button class="btn" onclick="addSponsor()">Add Sponsor</button>
        </div>
    </div>

    <!-- Announcement Modal -->
    <div id="announcementModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="hideModal('announcementModal')">&times;</span>
            <h2 style="margin-bottom: 20px; text-align: center;">Make Announcement</h2>
            <div class="form-group">
                <label for="announcementTitle">Title:</label>
                <input type="text" id="announcementTitle" placeholder="Announcement title">
            </div>
            <div class="form-group">
                <label for="announcementMessage">Message:</label>
                <textarea id="announcementMessage" rows="4" placeholder="Announcement message"></textarea>
            </div>
            <div class="form-group">
                <label for="announcementType">Type:</label>
                <select id="announcementType">
                    <option value="info">Information</option>
                    <option value="urgent">Urgent</option>
                    <option value="celebration">Celebration</option>
                </select>
            </div>
            <button class="btn" onclick="makeAnnouncement()">Send Announcement</button>
        </div>
    </div>

    <!-- Sponsor Video Modal -->
    <div id="sponsorVideoModal" class="modal">
        <div class="modal-content" style="max-width: 800px; text-align: center;">
            <h2 style="margin-bottom: 20px; color: #667eea;">üé¨ Message from Our Sponsors</h2>
            <div style="position: relative; width: 100%; height: 400px; background: #000; border-radius: 15px; overflow: hidden; margin-bottom: 20px;">
                <video id="sponsorVideo" width="100%" height="100%" controls style="object-fit: cover;">
                    <source src="" type="video/mp4">
                    Your browser does not support the video tag.
                </video>
            </div>
            <p style="color: #666; margin-bottom: 20px; font-size: 16px;">
                üôè Our events are made possible by the generous support of our sponsors. Please take a moment to watch this message from our partners who help make these amazing events happen!
            </p>
            <div style="background: rgba(102, 126, 234, 0.1); padding: 15px; border-radius: 10px; margin: 20px 0;">
                <p style="color: #667eea; margin: 0; font-weight: 500;">
                    ‚è±Ô∏è After watching or skipping this video, you'll be successfully enrolled in the event!
                </p>
            </div>
            <button class="btn btn-secondary" id="skipVideoBtn" onclick="skipSponsorVideo()" style="margin-right: 10px;">Skip Video (5s)</button>
            <button class="btn" id="continueBtn" onclick="completeEnrollment()" style="display: none;">Continue to Enrollment</button>
        </div>
    </div>

    <!-- Enrollment Success Modal -->
    <div id="enrollmentSuccessModal" class="modal">
        <div class="modal-content" style="text-align: center; max-width: 500px;">
            <div style="font-size: 64px; margin-bottom: 20px;">üéâ</div>
            <h2 style="color: #28a745; margin-bottom: 20px;">Successfully Enrolled!</h2>
            <p style="color: #666; margin-bottom: 20px; font-size: 18px;">
                You have successfully enrolled in <strong id="enrolledEventTitle"></strong>
            </p>
            <div style="background: rgba(40, 167, 69, 0.1); padding: 20px; border-radius: 15px; margin: 20px 0;">
                <p style="color: #28a745; margin-bottom: 10px;">
                    <strong>üìÖ Event Details:</strong>
                </p>
                <p style="color: #666;" id="enrolledEventDetails"></p>
            </div>
            <p style="color: #666; margin-bottom: 20px;">
                Check your email for confirmation details and event updates!
            </p>
            <div id="qrCodeContainer" style="margin: 20px auto; max-width: 300px;"></div>
            <p style="font-size: 14px; color: #999;">Scan this code at the event venue to verify your booking.</p>
            <button class="btn" onclick="hideModal('enrollmentSuccessModal')">Got it!</button>
        </div>
    </div>

    <!-- Event Poster Modal -->
    <div id="eventPosterModal" class="event-poster-modal" onclick="hideModal('eventPosterModal')">
        <img id="eventPosterModalImage" src="" alt="Event Poster">
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>

    <script>
        // Global variables
        let currentUser = null;
        let currentUserType = null;
        let currentEditingEventId = null;
        let currentEnrollingEventId = null;
        let navigationHistory = ['home'];
        let currentPage = 'home';
        let skipCountdown = 5;
        let countdownInterval = null;
        let html5QrcodeScanner = null;
        let isScanning = false;
        let enrollmentChart = null;
        let categoryChart = null;
        let financeChart = null;
        
        // Sponsor videos - Replace with your actual video paths
        const sponsorVideos = [
            "https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4",
            "https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ElephantsDream.mp4",
            "https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerBlazes.mp4"
        ];
        
        // Sample events data with payment info
        let events = [
            {
                id: 1,
                title: "Engineers Day Celebration",
                date: "2025-08-15",
                description: "Join us for a grand celebration of Engineers Day with various activities, competitions, and cultural programs.",
                location: "Gate 2",
                maxParticipants: 200,
                enrolledStudents: [
                    { name: "Rahul", enrollDate: "2025-07-18", paymentStatus: "paid", amount: 500 },
                    { name: "Diya", enrollDate: "2025-07-19", paymentStatus: "pending", amount: 500 },
                    { name: "Swayam", enrollDate: "2025-07-20", paymentStatus: "paid", amount: 500 },
                    { name: "Anish", enrollDate: "2025-07-21", paymentStatus: "paid", amount: 500 }
                ],
                poster: "https://st.adda247.com/https://wpassets.adda247.com/wp-content/uploads/multisite/sites/5/2022/09/15080104/engineers-day-5f2bb117edd5c-1596698903.jpg",
                budget: 50000,
                status: "upcoming",
                fee: 500
            },
            {
                id: 2,
                title: "Independence Day Ceremony",
                date: "2025-09-20",
                description: "Celebrate our nation's independence with a special ceremony featuring speeches, performances, and cultural displays.",
                location: "University Auditorium",
                maxParticipants: 200,
                enrolledStudents: [
                    { name: "Rahul", enrollDate: "2025-07-15", paymentStatus: "free", amount: 0 },
                    { name: "Krish", enrollDate: "2025-07-16", paymentStatus: "free", amount: 0 }
                ],
                poster: "https://imgk.timesnownews.com/media/Independance_day_2.jpg",
                budget: 75000,
                status: "upcoming",
                fee: 0
            },
            {
                id: 3,
                title: "Ras Garba Night",
                date: "2025-10-10",
                description: "Aaa halo jo ras garba maza aavse! Join us for a night of traditional dance, music, and celebration.",
                location: "Ground 2",
                maxParticipants: 500,
                enrolledStudents: [
                    { name: "Abhinav", enrollDate: "2025-07-10", paymentStatus: "paid", amount: 300 },
                    { name: "Sita", enrollDate: "2025-07-11", paymentStatus: "paid", amount: 300 },
                    { name: "Anish", enrollDate: "2025-07-12", paymentStatus: "pending", amount: 300 },
                    { name: "Grishma", enrollDate: "2025-07-13", paymentStatus: "paid", amount: 300 },
                    { name: "Rahul", enrollDate: "2025-07-14", paymentStatus: "paid", amount: 300 }
                ],
                poster: "https://static.vecteezy.com/system/resources/thumbnails/000/132/866/small_2x/vector-design-of-woman-playing-garba-dance.jpg",
                budget: 100000,
                status: "upcoming",
                fee: 300
            }
        ];

        let sponsors = [
            { id: 1, name: "Sai Groups", amount: 100000, contact: "Mr. Sharma", email: "contact@saigroups.com" },
            { id: 2, name: "Campa", amount: 50000, contact: "Ms. Patel", email: "info@campa.com" },
            { id: 3, name: "Sabbero", amount: 75000, contact: "Mr. Singh", email: "hello@sabbero.com" },
            { id: 4, name: "Lenovo", amount: 200000, contact: "Ms. Kumar", email: "partnerships@lenovo.com" }
        ];

        let budgetCategories = [
            { name: "Events", allocated: 300000, spent: 180000 },
            { name: "Equipment", allocated: 100000, spent: 45000 },
            { name: "Marketing", allocated: 50000, spent: 32000 },
            { name: "Miscellaneous", allocated: 75000, spent: 28000 }
        ];

        let feedbacks = [
            {
                id: 1,
                author: "Sahil Mishra",
                text: "The recent cultural festival was amazing! Great job organizing it.",
                date: "2025-07-10"
            },
            {
                id: 2,
                author: "Bhavya Chauhan",
                text: "Would love to see more sports events and competitions.",
                date: "2025-07-08"
            },
            {
                id: 3,
                author: "Priya Singh",
                text: "The Engineers Day celebration was well organized. Looking forward to more such events!",
                date: "2025-07-12"
            },
            {
                id: 4,
                author: "Arjun Patel",
                text: "Suggestion: Can we have more outdoor activities? The weather is perfect for it.",
                date: "2025-07-14"
            }
        ];

        let galleryPhotos = [
            {
                id: 1,
                title: "Cultural Festival 2024",
                description: "Students performing traditional dances during our annual cultural festival",
                category: "events",
                image: "https://images.unsplash.com/photo-1511671782779-c97d3d27a1d4?w=500&h=300&fit=crop",
                uploadedBy: "secretary",
                uploadDate: "2025-07-15"
            },
            {
                id: 2,
                title: "Science Exhibition",
                description: "Amazing projects displayed by our talented students",
                category: "activities",
                image: "https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=500&h=300&fit=crop",
                uploadedBy: "secretary",
                uploadDate: "2025-07-12"
            },
            {
                id: 3,
                title: "Campus Garden",
                description: "Beautiful flowers blooming in our campus garden",
                category: "campus",
                image: "https://images.unsplash.com/photo-1416879595882-3373a0480b5b?w=500&h=300&fit=crop",
                uploadedBy: "secretary",
                uploadDate: "2025-07-10"
            }
        ];

        let recentActivities = [
            { action: "New student enrolled", details: "Rahul enrolled in Engineers Day Celebration", time: "2 mins ago" },
            { action: "Event created", details: "Independence Day Ceremony added", time: "1 hour ago" },
            { action: "Photo uploaded", details: "Cultural Festival photos added to gallery", time: "3 hours ago" },
            { action: "Sponsor added", details: "Lenovo partnership confirmed", time: "1 day ago" },
            { action: "Payment received", details: "Diya paid for Garba Night", time: "2 hours ago" }
        ];

        // Initialize the page
        function init() {
            console.log('Initializing page...');
            showTab('home');
            updateEventsList();
            updateFeedbackList();
            updateGalleryList();
            updateBackButton();
            
            // Set minimum date to today
            const today = new Date().toISOString().split('T')[0];
            const eventDate = document.getElementById('eventDate');
            const editEventDate = document.getElementById('editEventDate');
            if (eventDate) eventDate.min = today;
            if (editEventDate) editEventDate.min = today;
            
            console.log('Page initialized successfully');
        }

        // Tab navigation
        function showTab(tabName) {
            console.log('Showing tab:', tabName);
            
            // Stop scanner if leaving scan tab
            if (currentPage === 'scan' && tabName !== 'scan') {
                stopScanner();
            }

            // Add to navigation history if it's a new page
            if (currentPage !== tabName) {
                navigationHistory.push(tabName);
                if (navigationHistory.length > 10) {
                    navigationHistory.shift();
                }
                currentPage = tabName;
            }

            if (tabName === 'enrolled') {
                updateEnrolledEvents();
            } else if (tabName === 'dashboard') {
                updateDashboard();
            } else if (tabName === 'finance') {
                updateFinanceData();
            } else if (tabName === 'manage-events') {
                updateEventManagement();
            }
            
            // Hide all tab contents
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(tab => tab.classList.add('hidden'));
            
            // Show selected tab
            const targetTab = document.getElementById(tabName);
            if (targetTab) {
                targetTab.classList.remove('hidden');
            }
            
            // Update active tab
            const tabs = document.querySelectorAll('.nav-tab');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            // Find and activate the correct tab button
            const tabButtons = document.querySelectorAll('.nav-tab');
            tabButtons.forEach(button => {
                const buttonText = button.textContent.toLowerCase();
                if ((tabName === 'home' && buttonText === 'home') ||
                    (tabName === 'about' && buttonText === 'about') ||
                    (tabName === 'events' && buttonText === 'events') ||
                    (tabName === 'enrolled' && buttonText.includes('enrolled')) ||
                    (tabName === 'scan' && buttonText.includes('scan')) ||
                    (tabName === 'gallery' && buttonText === 'gallery') ||
                    (tabName === 'sponsors' && buttonText === 'sponsors') ||
                    (tabName === 'feedback' && buttonText === 'feedback') ||
                    (tabName === 'dashboard' && buttonText === 'dashboard') ||
                    (tabName === 'finance' && buttonText === 'finance') ||
                    (tabName === 'manage-events' && buttonText.includes('manage events'))) {
                    button.classList.add('active');
                }
            });
            
            updateBackButton();
        }

        // Back button functionality
        function goBack() {
            console.log('Going back...');
            if (navigationHistory.length > 1) {
                navigationHistory.pop();
                const previousPage = navigationHistory[navigationHistory.length - 1];
                currentPage = previousPage;
                showTab(previousPage);
            }
        }

        function updateBackButton() {
            const backBtn = document.getElementById('backBtn');
            if (!backBtn) return;
            
            if (navigationHistory.length > 1 && currentPage !== 'home') {
                backBtn.style.display = 'block';
                const previousPage = navigationHistory[navigationHistory.length - 2];
                backBtn.innerHTML = `‚Üê Back to ${previousPage.charAt(0).toUpperCase() + previousPage.slice(1)}`;
            } else {
                backBtn.style.display = 'none';
            }
        }

        // Login functionality
        function showLogin() {
            showModal('loginModal');
        }

        function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const userType = document.getElementById('userType').value;

            let isValidCredentials = false;
            
            if (userType === 'student' && username === 'student' && password === 'student123') {
                isValidCredentials = true;
            } else if (userType === 'secretary' && username === 'secretary' && password === 'secretary123') {
                isValidCredentials = true;
            } else if (userType === 'management' && username === 'admin' && password === 'admin123') {
                isValidCredentials = true;
            }

            if (isValidCredentials) {
                currentUser = username;
                currentUserType = userType;
                
                // Update UI based on user type
                const badgeClass = userType === 'management' ? 'user-badge management' : 'user-badge';
                document.getElementById('userInfo').innerHTML = `
                    <div class="${badgeClass}">${userType.charAt(0).toUpperCase() + userType.slice(1)}: ${username}</div>
                    <button class="btn btn-secondary" onclick="logout()">Logout</button>
                `;
                
                // Show user-specific features
                if (userType === 'student') {
                    document.getElementById('enrolledTab').style.display = 'inline-block';
                    updateEnrolledEvents();
                } else if (userType === 'secretary') {
                    document.getElementById('scanTab').style.display = 'inline-block';
                    const addEventBtn = document.getElementById('addEventBtn');
                    const addPhotoBtn = document.getElementById('addPhotoBtn');
                    if (addEventBtn) addEventBtn.style.display = 'block';
                    if (addPhotoBtn) addPhotoBtn.style.display = 'block';
                } else if (userType === 'management') {
                    // Show all management tabs
                    document.getElementById('dashboardTab').style.display = 'inline-block';
                    document.getElementById('financeTab').style.display = 'inline-block';
                    document.getElementById('manageEventsTab').style.display = 'inline-block';
                    document.getElementById('scanTab').style.display = 'inline-block';
                    const addEventBtn = document.getElementById('addEventBtn');
                    const addPhotoBtn = document.getElementById('addPhotoBtn');
                    if (addEventBtn) addEventBtn.style.display = 'block';
                    if (addPhotoBtn) addPhotoBtn.style.display = 'block';
                    
                    // Redirect to dashboard
                    showTab('dashboard');
                }
                
                hideModal('loginModal');
                updateEventsList();
                updateGalleryList();
                
                // Clear form
                document.getElementById('username').value = '';
                document.getElementById('password').value = '';
                
                console.log('Login successful:', userType, username);
            } else {
                alert('Invalid credentials! Please use the demo credentials provided.');
            }
        }

        function logout() {
            stopScanner(); // Stop scanner if active
            currentUser = null;
            currentUserType = null;
            document.getElementById('userInfo').innerHTML = '<button class="btn" onclick="showLogin()">Login</button>';
            
            // Hide user-specific features
            document.getElementById('enrolledTab').style.display = 'none';
            document.getElementById('scanTab').style.display = 'none';
            document.getElementById('dashboardTab').style.display = 'none';
            document.getElementById('financeTab').style.display = 'none';
            document.getElementById('manageEventsTab').style.display = 'none';
            
            const addEventBtn = document.getElementById('addEventBtn');
            const addPhotoBtn = document.getElementById('addPhotoBtn');
            if (addEventBtn) addEventBtn.style.display = 'none';
            if (addPhotoBtn) addPhotoBtn.style.display = 'none';
            
            updateEventsList();
            updateGalleryList();
            showTab('home');
            console.log('Logout successful');
        }

        // Event Records functionality
        function showEventRecordsModal() {
            const select = document.getElementById('recordEventSelect');
            select.innerHTML = '<option value="">Choose an event...</option>';
            
            events.forEach(event => {
                const option = document.createElement('option');
                option.value = event.id;
                option.textContent = event.title;
                select.appendChild(option);
            });
            
            showModal('eventRecordsModal');
        }

        function loadEventRecords() {
            const eventId = document.getElementById('recordEventSelect').value;
            const container = document.getElementById('eventRecordsContainer');
            
            if (!eventId) {
                container.style.display = 'none';
                return;
            }
            
            const event = events.find(e => e.id == eventId);
            if (!event) return;
            
            container.style.display = 'block';
            
            // Update event details
            document.getElementById('selectedEventTitle').textContent = event.title;
            document.getElementById('selectedEventDetails').innerHTML = `
                üìÖ ${new Date(event.date).toLocaleDateString()} | üìç ${event.location} | 
                üí∞ Fee: ${event.fee > 0 ? `‚Çπ${event.fee}` : 'Free'} | 
                üë• ${event.enrolledStudents.length}/${event.maxParticipants} enrolled
            `;
            
            // Update student records
            const recordsList = document.getElementById('studentRecordsList');
            recordsList.innerHTML = event.enrolledStudents.map(student => {
                const statusClass = student.paymentStatus === 'paid' ? 'payment-paid' : 
                                  student.paymentStatus === 'pending' ? 'payment-pending' : 'payment-free';
                const statusText = student.paymentStatus === 'paid' ? 'Paid' : 
                                 student.paymentStatus === 'pending' ? 'Pending' : 'Free Event';
                
                return `
                    <div class="student-record">
                        <div>${student.name}</div>
                        <div>${new Date(student.enrollDate).toLocaleDateString()}</div>
                        <div><span class="payment-status ${statusClass}">${statusText}</span></div>
                        <div>‚Çπ${student.amount}</div>
                        <div>
                            ${student.paymentStatus === 'pending' ? 
                                `<button class="btn btn-sm btn-success" onclick="updatePaymentStatus(${event.id}, '${student.name}', 'paid')">Mark Paid</button>` : 
                                `<button class="btn btn-sm btn-secondary" onclick="viewStudentDetails('${student.name}')">View Details</button>`
                            }
                        </div>
                    </div>
                `;
            }).join('');
            
            // Update summary
            const totalEnrolled = event.enrolledStudents.length;
            const totalPaid = event.enrolledStudents.filter(s => s.paymentStatus === 'paid').reduce((sum, s) => sum + s.amount, 0);
            const totalPending = event.enrolledStudents.filter(s => s.paymentStatus === 'pending').reduce((sum, s) => sum + s.amount, 0);
            const enrollmentRate = Math.round((totalEnrolled / event.maxParticipants) * 100);
            
            document.getElementById('totalEnrolled').textContent = totalEnrolled;
            document.getElementById('totalPaid').textContent = `‚Çπ${totalPaid.toLocaleString()}`;
            document.getElementById('totalPending').textContent = `‚Çπ${totalPending.toLocaleString()}`;
            document.getElementById('enrollmentRate').textContent = `${enrollmentRate}%`;
        }

        function updatePaymentStatus(eventId, studentName, newStatus) {
            const event = events.find(e => e.id === eventId);
            if (!event) return;
            
            const student = event.enrolledStudents.find(s => s.name === studentName);
            if (!student) return;
            
            student.paymentStatus = newStatus;
            
            // Add to recent activities
            recentActivities.unshift({
                action: "Payment updated",
                details: `${studentName} payment marked as ${newStatus} for ${event.title}`,
                time: 'Just now'
            });
            
            loadEventRecords(); // Refresh the records
            alert(`Payment status updated successfully for ${studentName}!`);
        }

        function viewStudentDetails(studentName) {
            alert(`Student Details:\n\nName: ${studentName}\n\nContact: student@college.edu\nStudent ID: STU${Math.floor(Math.random() * 10000)}\nYear: 3rd Year\nDepartment: Computer Science`);
        }

        function exportEventRecord() {
            const eventId = document.getElementById('recordEventSelect').value;
            if (!eventId) {
                alert('Please select an event first!');
                return;
            }
            
            const event = events.find(e => e.id == eventId);
            if (!event) return;
            
            alert(`üìä Event Record Export\n\nEvent: ${event.title}\nDate: ${event.date}\nTotal Students: ${event.enrolledStudents.length}\nTotal Revenue: ‚Çπ${event.enrolledStudents.reduce((sum, s) => sum + (s.paymentStatus === 'paid' ? s.amount : 0), 0)}\n\nRecord has been exported successfully!`);
        }

        // Dashboard functions
        function updateDashboard() {
            updateMetrics();
            updateCharts();
            updateRecentActivity();
        }

        function updateMetrics() {
            // Calculate metrics
            const allStudents = new Set();
            events.forEach(event => {
                event.enrolledStudents.forEach(student => {
                    allStudents.add(student.name);
                });
            });
            const totalStudents = allStudents.size;
            const activeEvents = events.filter(e => e.status === 'upcoming').length;
            const totalEnrollments = events.reduce((sum, e) => sum + e.enrolledStudents.length, 0);
            const totalBudget = events.reduce((sum, e) => sum + (e.budget || 0), 0);

            // Update DOM
            document.getElementById('totalStudentsMetric').textContent = totalStudents;
            document.getElementById('activeEventsMetric').textContent = activeEvents;
            document.getElementById('totalEnrollmentsMetric').textContent = totalEnrollments;
            document.getElementById('totalRevenueMetric').textContent = `‚Çπ${totalBudget.toLocaleString()}`;
        }

        function updateCharts() {
            // Enrollment trends chart
            const ctx1 = document.getElementById('enrollmentChart').getContext('2d');
            if (enrollmentChart) enrollmentChart.destroy();
            
            enrollmentChart = new Chart(ctx1, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul'],
                    datasets: [{
                        label: 'Monthly Enrollments',
                        data: [12, 19, 15, 25, 22, 30, 35],
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });

            // Category distribution chart
            const ctx2 = document.getElementById('categoryChart').getContext('2d');
            if (categoryChart) categoryChart.destroy();
            
            categoryChart = new Chart(ctx2, {
                type: 'doughnut',
                data: {
                    labels: ['Cultural', 'Academic', 'Sports', 'Social'],
                    datasets: [{
                        data: [30, 25, 20, 25],
                        backgroundColor: [
                            '#667eea',
                            '#764ba2',
                            '#28a745',
                            '#ffc107'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        function updateRecentActivity() {
            const activityContainer = document.getElementById('recentActivity');
            activityContainer.innerHTML = recentActivities.slice(0, 5).map(activity => `
                <div style="padding: 10px 0; border-bottom: 1px solid #e9ecef;">
                    <div style="font-weight: 500; color: #333;">${activity.action}</div>
                    <div style="font-size: 14px; color: #666;">${activity.details}</div>
                    <div style="font-size: 12px; color: #999; margin-top: 5px;">${activity.time}</div>
                </div>
            `).join('');
        }

        // Finance functions
        function updateFinanceData() {
            updateBudgetOverview();
            updateSponsorManagement();
            updateFinanceChart();
        }

        function updateBudgetOverview() {
            const container = document.getElementById('budgetOverview');
            container.innerHTML = budgetCategories.map(category => {
                const percentage = Math.round((category.spent / category.allocated) * 100);
                return `
                    <div class="budget-item">
                        <div>
                            <div style="font-weight: 500;">${category.name}</div>
                            <div style="font-size: 14px; color: #666;">‚Çπ${category.spent.toLocaleString()} / ‚Çπ${category.allocated.toLocaleString()}</div>
                            <div class="budget-progress">
                                <div class="budget-progress-bar" style="width: ${percentage}%"></div>
                            </div>
                        </div>
                        <div style="font-weight: bold; color: ${percentage > 80 ? '#dc3545' : '#28a745'};">
                            ${percentage}%
                        </div>
                    </div>
                `;
            }).join('');
        }

        function updateSponsorManagement() {
            const container = document.getElementById('sponsorManagement');
            container.innerHTML = sponsors.map(sponsor => `
                <div class="sponsor-item">
                    <div>
                        <div style="font-weight: 500;">${sponsor.name}</div>
                        <div style="font-size: 14px; color: #666;">${sponsor.contact} - ${sponsor.email}</div>
                    </div>
                    <div style="font-weight: bold; color: #28a745;">‚Çπ${sponsor.amount.toLocaleString()}</div>
                </div>
            `).join('');
        }

        function updateFinanceChart() {
            const ctx = document.getElementById('financeChart').getContext('2d');
            if (financeChart) financeChart.destroy();
            
            financeChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: budgetCategories.map(c => c.name),
                    datasets: [{
                        label: 'Allocated',
                        data: budgetCategories.map(c => c.allocated),
                        backgroundColor: 'rgba(102, 126, 234, 0.6)'
                    }, {
                        label: 'Spent',
                        data: budgetCategories.map(c => c.spent),
                        backgroundColor: 'rgba(40, 167, 69, 0.6)'
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        }

        // Event Management functions
        function updateEventManagement() {
            updateEventStats();
            updateEventsTable();
        }

        function updateEventStats() {
            const upcomingEvents = events.filter(e => e.status === 'upcoming').length;
            const totalParticipants = events.reduce((sum, e) => sum + e.enrolledStudents.length, 0);
            const totalCapacity = events.reduce((sum, e) => sum + e.maxParticipants, 0);
            const averageEnrollment = totalCapacity > 0 ? Math.round((totalParticipants / totalCapacity) * 100) : 0;

            document.getElementById('upcomingEventsCount').textContent = upcomingEvents;
            document.getElementById('totalParticipants').textContent = totalParticipants;
            document.getElementById('averageEnrollment').textContent = `${averageEnrollment}%`;
        }

        function updateEventsTable() {
            const tbody = document.getElementById('eventsTableBody');
            tbody.innerHTML = events.map(event => {
                const enrollmentRate = Math.round((event.enrolledStudents.length / event.maxParticipants) * 100);
                const statusBadge = getStatusBadge(event.status);
                
                return `
                    <div class="table-row">
                        <div>${event.title}</div>
                        <div>${new Date(event.date).toLocaleDateString()}</div>
                        <div>${event.location}</div>
                        <div>${event.enrolledStudents.length}/${event.maxParticipants}</div>
                        <div>${statusBadge}</div>
                        <div class="event-actions-table">
                            <button class="btn btn-sm" onclick="showEditEventModal(${event.id})">Edit</button>
                            <button class="btn btn-sm btn-danger" onclick="deleteEvent(${event.id})">Delete</button>
                            <button class="btn btn-sm btn-secondary" onclick="viewEventDetails(${event.id})">Details</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function getStatusBadge(status) {
            const colors = {
                upcoming: '#007bff',
                ongoing: '#28a745',
                completed: '#6c757d'
            };
            return `<span style="padding: 4px 8px; background: ${colors[status]}; color: white; border-radius: 10px; font-size: 12px;">${status}</span>`;
        }

        function filterEvents() {
            // Implementation for filtering events based on status and search
            updateEventsTable();
        }

        function viewEventDetails(eventId) {
            const event = events.find(e => e.id === eventId);
            if (event) {
                const totalRevenue = event.enrolledStudents.reduce((sum, s) => sum + (s.paymentStatus === 'paid' ? s.amount : 0), 0);
                const pendingRevenue = event.enrolledStudents.reduce((sum, s) => sum + (s.paymentStatus === 'pending' ? s.amount : 0), 0);
                
                alert(`Event Details:\n\nTitle: ${event.title}\nDate: ${event.date}\nLocation: ${event.location}\nEnrolled: ${event.enrolledStudents.length}/${event.maxParticipants}\nBudget: ‚Çπ${event.budget?.toLocaleString() || 'N/A'}\nRevenue Collected: ‚Çπ${totalRevenue.toLocaleString()}\nRevenue Pending: ‚Çπ${pendingRevenue.toLocaleString()}\nEvent Fee: ‚Çπ${event.fee || 0}`);
            }
        }

        // Sponsor management
        function showAddSponsorModal() {
            showModal('addSponsorModal');
        }

        function addSponsor() {
            const name = document.getElementById('sponsorName').value;
            const amount = parseInt(document.getElementById('sponsorAmount').value);
            const contact = document.getElementById('sponsorContact').value;
            const email = document.getElementById('sponsorEmail').value;

            if (!name || !amount || !contact || !email) {
                alert('Please fill in all fields!');
                return;
            }

            const newSponsor = {
                id: Date.now(),
                name, amount, contact, email
            };

            sponsors.push(newSponsor);
            updateFinanceData();
            hideModal('addSponsorModal');
            
            // Add to recent activities
            recentActivities.unshift({
                action: "New sponsor added",
                details: `${name} partnership confirmed with ‚Çπ${amount.toLocaleString()} contribution`,
                time: 'Just now'
            });
            
            // Clear form
            document.getElementById('sponsorName').value = '';
            document.getElementById('sponsorAmount').value = '';
            document.getElementById('sponsorContact').value = '';
            document.getElementById('sponsorEmail').value = '';
            
            alert('Sponsor added successfully!');
        }

        // Announcement system
        function showAnnouncementModal() {
            showModal('announcementModal');
        }

        function makeAnnouncement() {
            const title = document.getElementById('announcementTitle').value;
            const message = document.getElementById('announcementMessage').value;
            const type = document.getElementById('announcementType').value;

            if (!title || !message) {
                alert('Please fill in all fields!');
                return;
            }

            // Add to recent activities
            recentActivities.unshift({
                action: `üì¢ ${type.charAt(0).toUpperCase() + type.slice(1)} announcement`,
                details: title,
                time: 'Just now'
            });

            hideModal('announcementModal');
            updateRecentActivity();
            
            // Clear form
            document.getElementById('announcementTitle').value = '';
            document.getElementById('announcementMessage').value = '';
            document.getElementById('announcementType').value = 'info';
            
            alert('Announcement sent successfully to all users!');
        }

        function generateReport() {
            const reportData = {
                totalEvents: events.length,
                totalStudents: new Set([].concat(...events.map(e => e.enrolledStudents.map(s => s.name)))).size,
                totalBudget: events.reduce((sum, e) => sum + (e.budget || 0), 0),
                totalSponsors: sponsors.length,
                totalSponsorAmount: sponsors.reduce((sum, s) => sum + s.amount, 0),
                totalRevenue: events.reduce((sum, e) => 
                    sum + e.enrolledStudents.reduce((eSum, s) => 
                        eSum + (s.paymentStatus === 'paid' ? s.amount : 0), 0), 0)
            };
            
            alert(`üìä COMPREHENSIVE MANAGEMENT REPORT\n\n` +
                  `üìÖ Total Events: ${reportData.totalEvents}\n` +
                  `üë• Unique Students: ${reportData.totalStudents}\n` +
                  `üí∞ Total Event Budget: ‚Çπ${reportData.totalBudget.toLocaleString()}\n` +
                  `üíµ Revenue Collected: ‚Çπ${reportData.totalRevenue.toLocaleString()}\n` +
                  `ü§ù Total Sponsors: ${reportData.totalSponsors}\n` +
                  `üí∞ Sponsor Contributions: ‚Çπ${reportData.totalSponsorAmount.toLocaleString()}\n\n` +
                  `Report generated on ${new Date().toLocaleDateString()}`);
        }

        function exportFinancialReport() {
            const totalRevenue = events.reduce((sum, e) => 
                sum + e.enrolledStudents.reduce((eSum, s) => 
                    eSum + (s.paymentStatus === 'paid' ? s.amount : 0), 0), 0);
            const totalPending = events.reduce((sum, e) => 
                sum + e.enrolledStudents.reduce((eSum, s) => 
                    eSum + (s.paymentStatus === 'pending' ? s.amount : 0), 0), 0);
            
            alert(`üìä FINANCIAL REPORT EXPORTED\n\n` +
                  `üí∞ Total Revenue: ‚Çπ${totalRevenue.toLocaleString()}\n` +
                  `‚è≥ Pending Payments: ‚Çπ${totalPending.toLocaleString()}\n` +
                  `ü§ù Sponsor Funding: ‚Çπ${sponsors.reduce((sum, s) => sum + s.amount, 0).toLocaleString()}\n\n` +
                  `The detailed financial report has been exported successfully!`);
        }

        // Modal management
        function showModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.style.display = 'block';
            }
        }

        function hideModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.style.display = 'none';
            }
        }

        // Event enrollment with sponsor video
        function enrollInEvent(eventId) {
            console.log('Enrolling in event:', eventId);
            
            if (!currentUser || currentUserType !== 'student') {
                alert('Please log in as a student to enroll in events!');
                return;
            }

            const event = events.find(e => e.id === eventId);
            if (!event) return;

            // Check if already enrolled
            if (event.enrolledStudents.some(s => s.name === currentUser)) {
                alert('You are already enrolled in this event!');
                return;
            }

            if (event.enrolledStudents.length >= event.maxParticipants) {
                alert('Sorry, this event is full!');
                return;
            }

            currentEnrollingEventId = eventId;
            showSponsorVideo();
        }

        function showSponsorVideo() {
            console.log('Showing sponsor video...');
            
            const randomVideo = sponsorVideos[Math.floor(Math.random() * sponsorVideos.length)];
            const video = document.getElementById('sponsorVideo');
            const modal = document.getElementById('sponsorVideoModal');
            
            if (video && modal) {
                video.src = randomVideo;
                video.load();
                
                showModal('sponsorVideoModal');
                document.getElementById('skipVideoBtn').style.display = 'block';
                document.getElementById('continueBtn').style.display = 'none';
                
                // Start countdown
                skipCountdown = 5;
                const skipBtn = document.getElementById('skipVideoBtn');
                skipBtn.disabled = true;
                skipBtn.textContent = `Skip Video (${skipCountdown}s)`;
                
                if (countdownInterval) clearInterval(countdownInterval);
                countdownInterval = setInterval(() => {
                    skipCountdown--;
                    if (skipCountdown > 0) {
                        skipBtn.textContent = `Skip Video (${skipCountdown}s)`;
                    } else {
                        skipBtn.textContent = 'Skip Video';
                        skipBtn.disabled = false;
                        clearInterval(countdownInterval);
                    }
                }, 1000);
                
                // Try to auto-play
                video.play().catch(error => {
                    console.log('Auto-play prevented:', error);
                });
                
                // Video end handler
                video.onended = function() {
                    if (countdownInterval) clearInterval(countdownInterval);
                    document.getElementById('skipVideoBtn').style.display = 'none';
                    document.getElementById('continueBtn').style.display = 'block';
                };
            }
        }

        function skipSponsorVideo() {
            const skipBtn = document.getElementById('skipVideoBtn');
            if (!skipBtn.disabled) {
                completeEnrollment();
            }
        }

        function completeEnrollment() {
            console.log('Completing enrollment...');
            
            const video = document.getElementById('sponsorVideo');
            if (video) {
                video.pause();
                video.currentTime = 0;
            }
            
            if (countdownInterval) {
                clearInterval(countdownInterval);
                countdownInterval = null;
            }
            
            hideModal('sponsorVideoModal');
            
            const event = events.find(e => e.id === currentEnrollingEventId);
            if (event) {
                // Add student with payment info
                const newStudent = {
                    name: currentUser,
                    enrollDate: new Date().toISOString().split('T')[0],
                    paymentStatus: event.fee > 0 ? 'pending' : 'free',
                    amount: event.fee || 0
                };
                
                event.enrolledStudents.push(newStudent);
                
                // Add to recent activities
                recentActivities.unshift({
                    action: "New student enrolled",
                    details: `${currentUser} enrolled in ${event.title}`,
                    time: 'Just now'
                });
                
                updateEventsList();
                
                setTimeout(() => {
                    showEnrollmentSuccess(event);
                }, 300);
            }
            
            currentEnrollingEventId = null;
        }

        function showEnrollmentSuccess(event) {
            const title = document.getElementById('enrolledEventTitle');
            const details = document.getElementById('enrolledEventDetails');
            const qrContainer = document.getElementById('qrCodeContainer');

            if (title && details && qrContainer) {
                title.textContent = event.title;
                details.innerHTML = `
                    <strong>üìÖ Date:</strong> ${new Date(event.date).toLocaleDateString()}<br>
                    <strong>üìç Location:</strong> ${event.location}<br>
                    <strong>üí∞ Fee:</strong> ${event.fee > 0 ? `‚Çπ${event.fee}` : 'Free'}<br>
                    <strong>üë• Participants:</strong> ${event.enrolledStudents.length}/${event.maxParticipants}
                `;

                const qrData = {
                    event: event.title,
                    date: event.date,
                    location: event.location,
                    user: currentUser,
                    timestamp: new Date().toISOString()
                };

                qrContainer.innerHTML = ""; // Clear old QR code
                new QRCode(qrContainer, {
                    text: JSON.stringify(qrData),
                    width: 256,
                    height: 256
                });

                showModal('enrollmentSuccessModal');
            }
        }

        function unenrollFromEvent(eventId) {
            if (!currentUser || currentUserType !== 'student') {
                alert('Please log in as a student to unenroll from events!');
                return;
            }

            const event = events.find(e => e.id === eventId);
            if (!event) return;

            const index = event.enrolledStudents.findIndex(s => s.name === currentUser);
            if (index > -1) {
                event.enrolledStudents.splice(index, 1);
                updateEventsList();
                updateEnrolledEvents();
                alert('Successfully unenrolled from the event!');
            }
        }

        function toggleParticipantsList(eventId) {
            const participantsList = document.getElementById(`participants-${eventId}`);
            if (participantsList) {
                participantsList.classList.toggle('hidden');
            }
        }

        function removeParticipant(eventId, studentName) {
            if (currentUserType !== 'secretary' && currentUserType !== 'management') {
                alert('Only secretaries and management can remove participants!');
                return;
            }

            if (confirm(`Are you sure you want to remove ${studentName} from this event?`)) {
                const event = events.find(e => e.id === eventId);
                if (event) {
                    const index = event.enrolledStudents.findIndex(s => s.name === studentName);
                    if (index > -1) {
                        event.enrolledStudents.splice(index, 1);
                        updateEventsList();
                    }
                }
            }
        }

        // Event management
        function showAddEventModal() {
            if (currentUserType !== 'secretary' && currentUserType !== 'management') {
                alert('Only secretaries and management can add events!');
                return;
            }
            showModal('addEventModal');
        }

        function clearAddEventForm() {
            const fields = ['eventTitle', 'eventDate', 'eventDescription', 'eventLocation', 'eventMaxParticipants', 'eventFee', 'eventPosterInput'];
            fields.forEach(fieldId => {
                const field = document.getElementById(fieldId);
                if (field) field.value = '';
            });
            const preview = document.getElementById('eventPosterPreview');
            if (preview) preview.innerHTML = '';
        }

        function addEvent() {
            const title = document.getElementById('eventTitle').value;
            const date = document.getElementById('eventDate').value;
            const description = document.getElementById('eventDescription').value;
            const location = document.getElementById('eventLocation').value;
            const maxParticipants = parseInt(document.getElementById('eventMaxParticipants').value) || 100;
            const fee = parseInt(document.getElementById('eventFee').value) || 0;
            const posterInput = document.getElementById('eventPosterInput');

            if (!title || !date || !description || !location) {
                alert('Please fill in all required fields!');
                return;
            }

            function createEvent(posterUrl = '') {
                const newEvent = {
                    id: Date.now(),
                    title: title,
                    date: date,
                    description: description,
                    location: location,
                    maxParticipants: maxParticipants,
                    enrolledStudents: [],
                    poster: posterUrl,
                    budget: fee * maxParticipants,
                    status: 'upcoming',
                    fee: fee
                };

                events.push(newEvent);
                
                // Add to recent activities
                recentActivities.unshift({
                    action: "Event created",
                    details: `${title} has been scheduled for ${new Date(date).toLocaleDateString()}`,
                    time: 'Just now'
                });
                
                updateEventsList();
                updateEventManagement();
                hideModal('addEventModal');
                clearAddEventForm();
                console.log('Event added:', newEvent);
                alert('Event created successfully!');
            }

            if (posterInput && posterInput.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    createEvent(e.target.result);
                };
                reader.readAsDataURL(posterInput.files[0]);
            } else {
                createEvent();
            }
        }

        function showEditEventModal(eventId) {
            if (currentUserType !== 'secretary' && currentUserType !== 'management') {
                alert('Only secretaries and management can edit events!');
                return;
            }
            
            const event = events.find(e => e.id === eventId);
            if (!event) return;

            currentEditingEventId = eventId;
            
            document.getElementById('editEventTitle').value = event.title;
            document.getElementById('editEventDate').value = event.date;
            document.getElementById('editEventDescription').value = event.description;
            document.getElementById('editEventLocation').value = event.location;
            document.getElementById('editEventMaxParticipants').value = event.maxParticipants;
            document.getElementById('editEventFee').value = event.fee || 0;
            
            const previewDiv = document.getElementById('editEventPosterPreview');
            if (previewDiv) {
                if (event.poster) {
                    previewDiv.innerHTML = `
                        <div class="image-preview-container">
                            <img src="${event.poster}" alt="Current Event Poster" class="image-preview">
                            <button type="button" class="remove-image-btn" onclick="removeImage('editEventPosterInput', 'editEventPosterPreview')">&times;</button>
                        </div>
                    `;
                } else {
                    previewDiv.innerHTML = '';
                }
            }
            
            showModal('editEventModal');
        }

        function updateEvent() {
            const title = document.getElementById('editEventTitle').value;
            const date = document.getElementById('editEventDate').value;
            const description = document.getElementById('editEventDescription').value;
            const location = document.getElementById('editEventLocation').value;
            const maxParticipants = parseInt(document.getElementById('editEventMaxParticipants').value) || 100;
            const fee = parseInt(document.getElementById('editEventFee').value) || 0;
            const posterInput = document.getElementById('editEventPosterInput');

            if (!title || !date || !description || !location) {
                alert('Please fill in all fields!');
                return;
            }

            const eventIndex = events.findIndex(e => e.id === currentEditingEventId);
            if (eventIndex !== -1) {
                function updateEventData(posterUrl = null) {
                    events[eventIndex] = {
                        ...events[eventIndex],
                        title: title,
                        date: date,
                        description: description,
                        location: location,
                        maxParticipants: maxParticipants,
                        fee: fee,
                        poster: posterUrl !== null ? posterUrl : events[eventIndex].poster
                    };
                    
                    // Add to recent activities
                    recentActivities.unshift({
                        action: "Event updated",
                        details: `${title} details have been modified`,
                        time: 'Just now'
                    });
                    
                    updateEventsList();
                    updateEventManagement();
                    hideModal('editEventModal');
                    currentEditingEventId = null;
                    console.log('Event updated:', events[eventIndex]);
                    alert('Event updated successfully!');
                }

                if (posterInput && posterInput.files[0]) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        updateEventData(e.target.result);
                    };
                    reader.readAsDataURL(posterInput.files[0]);
                } else {
                    updateEventData();
                }
            }
        }

        function deleteEvent(eventId) {
            if (currentUserType !== 'secretary' && currentUserType !== 'management') {
                alert('Only secretaries and management can delete events!');
                return;
            }
            
            const event = events.find(e => e.id === eventId);
            if (!event) return;
            
            if (confirm(`Are you sure you want to delete "${event.title}"? This action cannot be undone.`)) {
                events = events.filter(e => e.id !== eventId);
                
                // Add to recent activities
                recentActivities.unshift({
                    action: "Event deleted",
                    details: `${event.title} has been removed from the system`,
                    time: 'Just now'
                });
                
                updateEventsList();
                updateEventManagement();
                console.log('Event deleted:', eventId);
                alert('Event deleted successfully!');
            }
        }

        function updateEventsList() {
            const eventsList = document.getElementById('eventsList');
            if (!eventsList) return;
            
            if (events.length === 0) {
                eventsList.innerHTML = '<p style="text-align: center; color: #666;">No events scheduled at the moment.</p>';
                return;
            }

            eventsList.innerHTML = events.map(event => {
                const isEnrolled = currentUser && event.enrolledStudents.some(s => s.name === currentUser);
                const isFull = event.enrolledStudents.length >= event.maxParticipants;
                const canEnroll = currentUser && currentUserType === 'student' && !isEnrolled && !isFull;
                const canUnenroll = currentUser && currentUserType === 'student' && isEnrolled;
                
                let enrollmentStatusClass = 'enrollment-status';
                let enrollmentStatusText = `üë• ${event.enrolledStudents.length}/${event.maxParticipants} enrolled`;
                
                if (isFull) {
                    enrollmentStatusClass = 'enrollment-full';
                    enrollmentStatusText = 'üö´ Event Full';
                } else if (isEnrolled) {
                    enrollmentStatusClass = 'enrollment-enrolled';
                    enrollmentStatusText = '‚úÖ You are enrolled';
                }

                return `
                    <div class="event-card">
                        ${event.poster ? 
                            `<img src="${event.poster}" alt="${event.title} Poster" class="event-poster" onclick="showEventPosterModal('${event.poster}')">` : 
                            `<div class="event-poster-placeholder">üìÖ Event Poster</div>`
                        }
                        
                        <div class="event-header">
                            <div class="event-title">${event.title}</div>
                            <div class="event-date">${new Date(event.date).toLocaleDateString()}</div>
                        </div>
                        <div class="event-description">${event.description}</div>
                        <div style="margin-bottom: 15px; color: #667eea; font-weight: 500;">
                            üìç ${event.location} ${event.fee > 0 ? `| üí∞ Fee: ‚Çπ${event.fee}` : '| üÜì Free Event'}
                        </div>
                        
                        <div class="${enrollmentStatusClass}">
                            <span>${enrollmentStatusText}</span>
                        </div>
                        
                        <div class="event-actions">
                            ${canEnroll ? `<button class="btn btn-success" onclick="enrollInEvent(${event.id})">Enroll Now</button>` : ''}
                            ${canUnenroll ? `<button class="btn btn-warning" onclick="unenrollFromEvent(${event.id})">Unenroll</button>` : ''}
                            ${(currentUserType === 'secretary' || currentUserType === 'management') ? `
                                <button class="btn" onclick="showEditEventModal(${event.id})">Edit</button>
                                <button class="btn btn-danger" onclick="deleteEvent(${event.id})">Delete</button>
                                <button class="btn btn-secondary" onclick="toggleParticipantsList(${event.id})">View Participants</button>
                            ` : ''}
                        </div>
                        
                        ${(currentUserType === 'secretary' || currentUserType === 'management') ? `
                            <div id="participants-${event.id}" class="participants-list hidden">
                                <h4 style="margin-bottom: 10px;">Enrolled Participants (${event.enrolledStudents.length}/${event.maxParticipants})</h4>
                                ${event.enrolledStudents.length > 0 ? 
                                    event.enrolledStudents.map(student => `
                                        <div class="participant-item">
                                            <span>${student.name} ${student.paymentStatus === 'pending' ? '(Payment Pending)' : student.paymentStatus === 'paid' ? '(Paid)' : ''}</span>
                                            <button class="btn btn-danger" style="padding: 5px 10px; font-size: 12px;" onclick="removeParticipant(${event.id}, '${student.name}')">Remove</button>
                                        </div>
                                    `).join('') : 
                                    '<p style="color: #666; text-align: center;">No participants enrolled yet.</p>'
                                }
                            </div>
                        ` : ''}
                    </div>
                `;
            }).join('');
        }

        function updateEnrolledEvents() {
            const list = document.getElementById('enrolledEventsList');
            if (!list || !currentUser) return;

            const enrolledEvents = events.filter(e => e.enrolledStudents.some(s => s.name === currentUser));

            if (enrolledEvents.length === 0) {
                list.innerHTML = '<p style="color: #666;">You are not enrolled in any events yet.</p>';
                return;
            }

            list.innerHTML = enrolledEvents.map((event, index) => {
                const qrId = `qr-code-${event.id}-${index}`;
                const userEnrollment = event.enrolledStudents.find(s => s.name === currentUser);
                
                return `
                    <div class="event-card">
                        ${event.poster ? `<img src="${event.poster}" class="event-poster" alt="Poster" onclick="showEventPosterModal('${event.poster}')">` : ''}
                        <div class="event-title">${event.title}</div>
                        <div style="color:#667eea;"><strong>Date:</strong> ${new Date(event.date).toLocaleDateString()}</div>
                        <div style="color:#444;"><strong>Location:</strong> ${event.location}</div>
                        <div style="color:#444;"><strong>Fee:</strong> ${event.fee > 0 ? `‚Çπ${event.fee}` : 'Free'}</div>
                        ${userEnrollment && userEnrollment.paymentStatus === 'pending' ? 
                            `<div style="color:#ffc107; font-weight: bold;">‚ö†Ô∏è Payment Pending: ‚Çπ${userEnrollment.amount}</div>` : ''
                        }
                        <div class="event-description">${event.description}</div>
                        <div id="${qrId}" style="margin-top: 15px;"></div>
                        <p style="font-size: 14px; color: #999;">Scan this QR at the event venue to verify your booking.</p>
                    </div>
                `;
            }).join('');

            // Generate QR codes after DOM is updated
            enrolledEvents.forEach((event, index) => {
                const qrId = `qr-code-${event.id}-${index}`;
                const qrContainer = document.getElementById(qrId);

                if (qrContainer) {
                    const qrData = {
                        event: event.title,
                        date: event.date,
                        location: event.location,
                        user: currentUser,
                        timestamp: new Date().toISOString()
                    };

                    new QRCode(qrContainer, {
                        text: JSON.stringify(qrData),
                        width: 200,
                        height: 200
                    });
                }
            });
        }

        // Gallery functionality
        function showAddPhotoModal() {
            if (currentUserType !== 'secretary' && currentUserType !== 'management') {
                alert('Only secretaries and management can upload photos!');
                return;
            }
            showModal('addPhotoModal');
        }

        function addPhoto() {
            const title = document.getElementById('photoTitle').value;
            const description = document.getElementById('photoDescription').value;
            const category = document.getElementById('photoCategory').value;
            const photoInput = document.getElementById('photoUploadInput');

            if (!title || !description || !photoInput.files[0]) {
                alert('Please fill in all fields and select a photo!');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                const newPhoto = {
                    id: Date.now(),
                    title: title,
                    description: description,
                    category: category,
                    image: e.target.result,
                    uploadedBy: currentUser,
                    uploadDate: new Date().toISOString().split('T')[0]
                };

                galleryPhotos.unshift(newPhoto);
                
                // Add to recent activities
                recentActivities.unshift({
                    action: "Photo uploaded",
                    details: `${title} added to gallery`,
                    time: 'Just now'
                });
                
                updateGalleryList();
                hideModal('addPhotoModal');
                clearAddPhotoForm();
                console.log('Photo added:', newPhoto);
                alert('Photo uploaded successfully!');
            };
            reader.readAsDataURL(photoInput.files[0]);
        }

        function clearAddPhotoForm() {
            document.getElementById('photoTitle').value = '';
            document.getElementById('photoDescription').value = '';
            document.getElementById('photoCategory').value = 'events';
            document.getElementById('photoUploadInput').value = '';
            document.getElementById('photoUploadPreview').innerHTML = '';
        }

        function deletePhoto(photoId) {
            if (currentUserType !== 'secretary' && currentUserType !== 'management') {
                alert('Only secretaries and management can delete photos!');
                return;
            }
            
            if (confirm('Are you sure you want to delete this photo?')) {
                galleryPhotos = galleryPhotos.filter(photo => photo.id !== photoId);
                updateGalleryList();
                console.log('Photo deleted:', photoId);
                alert('Photo deleted successfully!');
            }
        }

        function updateGalleryList() {
            const galleryList = document.getElementById('galleryList');
            if (!galleryList) return;
            
            if (galleryPhotos.length === 0) {
                galleryList.innerHTML = '<p style="text-align: center; color: #666;">No photos uploaded yet.</p>';
                return;
            }

            galleryList.innerHTML = `
                <div class="gallery-grid">
                    ${galleryPhotos.map(photo => `
                        <div class="gallery-item">
                            <img src="${photo.image}" alt="${photo.title}" class="gallery-image" onclick="showEventPosterModal('${photo.image}')">
                            <div class="gallery-info">
                                <div class="gallery-title">${photo.title}</div>
                                <div class="gallery-description">${photo.description}</div>
                                <div class="gallery-meta">
                                    <span>üìÇ ${photo.category}</span>
                                    <span>üìÖ ${new Date(photo.uploadDate).toLocaleDateString()}</span>
                                </div>
                                ${(currentUserType === 'secretary' || currentUserType === 'management') ? `
                                    <div class="gallery-actions">
                                        <button class="btn btn-danger" style="padding: 8px 16px; font-size: 14px;" onclick="deletePhoto(${photo.id})">Delete</button>
                                    </div>
                                ` : ''}
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // Image handling
        function previewImage(inputId, previewId) {
            const input = document.getElementById(inputId);
            const preview = document.getElementById(previewId);
            const file = input.files[0];
            
            if (file && preview) {
                if (file.size > 5 * 1024 * 1024) {
                    alert('File size must be less than 5MB');
                    input.value = '';
                    return;
                }
                
                if (!file.type.startsWith('image/')) {
                    alert('Please select an image file');
                    input.value = '';
                    return;
                }
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.innerHTML = `
                        <div class="image-preview-container">
                            <img src="${e.target.result}" alt="Preview" class="image-preview">
                            <button type="button" class="remove-image-btn" onclick="removeImage('${inputId}', '${previewId}')">&times;</button>
                        </div>
                    `;
                };
                reader.readAsDataURL(file);
            }
        }

        function removeImage(inputId, previewId) {
            const input = document.getElementById(inputId);
            const preview = document.getElementById(previewId);
            if (input) input.value = '';
            if (preview) preview.innerHTML = '';
        }

        function showEventPosterModal(posterSrc) {
            const modal = document.getElementById('eventPosterModal');
            const image = document.getElementById('eventPosterModalImage');
            if (modal && image) {
                image.src = posterSrc;
                modal.style.display = 'block';
            }
        }

        // Feedback management
        function submitFeedback() {
            const feedbackText = document.getElementById('feedbackText');
            if (!feedbackText || !feedbackText.value.trim()) {
                alert('Please enter your feedback!');
                return;
            }

            const newFeedback = {
                id: feedbacks.length + 1,
                author: currentUser ? currentUser : 'Anonymous',
                text: feedbackText.value,
                date: new Date().toISOString().split('T')[0]
            };

            feedbacks.unshift(newFeedback);
            
            // Add to recent activities
            recentActivities.unshift({
                action: "Feedback received",
                details: `New feedback from ${newFeedback.author}`,
                time: 'Just now'
            });
            
            updateFeedbackList();
            feedbackText.value = '';
            console.log('Feedback submitted:', newFeedback);
            alert('Thank you for your feedback!');
        }

        function updateFeedbackList() {
            const feedbackList = document.getElementById('feedbackList');
            if (!feedbackList) return;
            
            if (feedbacks.length === 0) {
                feedbackList.innerHTML = '<p style="text-align: center; color: #666;">No feedback yet.</p>';
                return;
            }

            feedbackList.innerHTML = feedbacks.map(feedback => `
                <div class="feedback-item">
                    <div class="feedback-header">
                        <div class="feedback-author">${feedback.author}</div>
                        <div class="feedback-date">${new Date(feedback.date).toLocaleDateString()}</div>
                    </div>
                    <div>${feedback.text}</div>
                </div>
            `).join('');
        }

        // QR Scanner functionality
        function initializeScanner() {
            const resultContainer = document.getElementById('scanResult');
            const startBtn = document.getElementById('startScannerBtn');
            const stopBtn = document.getElementById('stopScannerBtn');
            
            if (isScanning) {
                return;
            }

            resultContainer.innerHTML = "üì∑ Requesting camera permission...";
            startBtn.style.display = 'none';
            
            try {
                if (html5QrcodeScanner) {
                    html5QrcodeScanner.stop().then(() => {
                        html5QrcodeScanner.clear();
                        html5QrcodeScanner = null;
                        startScanning();
                    }).catch(err => {
                        console.error("Error stopping previous scanner:", err);
                        startScanning();
                    });
                } else {
                    startScanning();
                }
            } catch (error) {
                console.error("Error initializing scanner:", error);
                resultContainer.innerHTML = `<p style="color: red;">‚ùå Error: ${error.message}</p>`;
                startBtn.style.display = 'block';
            }

            function startScanning() {
                html5QrcodeScanner = new Html5Qrcode("reader");
                
                const config = {
                    fps: 10,
                    qrbox: { width: 250, height: 250 },
                    aspectRatio: 1.0
                };

                html5QrcodeScanner.start(
                    { facingMode: "environment" },
                    config,
                    (qrCodeMessage) => {
                        try {
                            resultContainer.innerHTML = "üîç Verifying QR code...";
                            
                            const data = JSON.parse(qrCodeMessage);
                            const matchedEvent = events.find(ev => 
                                ev.title === data.event &&
                                ev.date === data.date &&
                                ev.location === data.location &&
                                ev.enrolledStudents.some(s => s.name === data.user)
                            );

                            if (matchedEvent) {
                                resultContainer.innerHTML = `
                                    <div style="color: green; text-align: center;">
                                        <h3>‚úÖ QR Code Verified!</h3>
                                        <p><strong>Event:</strong> ${data.event}</p>
                                        <p><strong>Date:</strong> ${new Date(data.date).toLocaleDateString()}</p>
                                        <p><strong>Location:</strong> ${data.location}</p>
                                        <p><strong>Student:</strong> ${data.user}</p>
                                        <p><strong>Verified at:</strong> ${new Date().toLocaleString()}</p>
                                        <div style="background: rgba(40, 167, 69, 0.1); padding: 15px; border-radius: 10px; margin-top: 15px;">
                                            <p style="color: #28a745; margin: 0;">Student is enrolled and verified for this event!</p>
                                        </div>
                                    </div>
                                `;
                            } else {
                                resultContainer.innerHTML = `
                                    <div style="color: red; text-align: center;">
                                        <h3>‚ùå Invalid QR Code</h3>
                                        <p>This QR code is either not genuine or the student is not enrolled in the specified event.</p>
                                        <div style="background: rgba(220, 53, 69, 0.1); padding: 15px; border-radius: 10px; margin-top: 15px;">
                                            <p style="color: #dc3545; margin: 0;">Access denied!</p>
                                        </div>
                                    </div>
                                `;
                            }
                        } catch (err) {
                            console.error("Error parsing QR code:", err);
                            resultContainer.innerHTML = `
                                <div style="color: red; text-align: center;">
                                    <h3>‚ùå Invalid QR Code Format</h3>
                                    <p>This QR code is not a valid student enrollment code.</p>
                                </div>
                            `;
                        }
                    },
                    (errorMessage) => {
                        // Scanning in progress - don't show errors
                    }
                ).then(() => {
                    console.log("QR Code scanner started successfully.");
                    isScanning = true;
                    stopBtn.style.display = 'block';
                    resultContainer.innerHTML = "üì± Scanner active - Point camera at QR code";
                }).catch(err => {
                    console.error("Unable to start scanning:", err);
                    isScanning = false;
                    startBtn.style.display = 'block';
                    stopBtn.style.display = 'none';
                    
                    if (err.name === 'NotAllowedError') {
                        resultContainer.innerHTML = `
                            <div style="color: red; text-align: center;">
                                <h3>üì∑ Camera Permission Denied</h3>
                                <p>Please allow camera access and try again.</p>
                                <p style="font-size: 14px; color: #666;">You may need to refresh the page and grant permission.</p>
                            </div>
                        `;
                    } else {
                        resultContainer.innerHTML = `
                            <div style="color: red; text-align: center;">
                                <h3>‚ùå Camera Error</h3>
                                <p>Unable to access camera: ${err.message}</p>
                                <p style="font-size: 14px; color: #666;">Please check camera permissions and try again.</p>
                            </div>
                        `;
                    }
                });
            }
        }

        function stopScanner() {
            const resultContainer = document.getElementById('scanResult');
            const startBtn = document.getElementById('startScannerBtn');
            const stopBtn = document.getElementById('stopScannerBtn');
            
            if (html5QrcodeScanner && isScanning) {
                html5QrcodeScanner.stop().then(() => {
                    html5QrcodeScanner.clear();
                    html5QrcodeScanner = null;
                    isScanning = false;
                    startBtn.style.display = 'block';
                    stopBtn.style.display = 'none';
                    resultContainer.innerHTML = 'Scanner stopped. Click "Start Camera" to begin scanning QR codes';
                    console.log("QR Code scanner stopped.");
                }).catch(err => {
                    console.error("Error stopping scanner:", err);
                    isScanning = false;
                    startBtn.style.display = 'block';
                    stopBtn.style.display = 'none';
                });
            }
        }

        // Close modals when clicking outside
        window.addEventListener('click', function(event) {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        });

        // Initialize when page loads
        document.addEventListener('DOMContentLoaded', init);
        window.addEventListener('load', init);
    </script>
</body>
</html>
        